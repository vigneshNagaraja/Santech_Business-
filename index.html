<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Project Time Record â€” Fillable Weekly Sheet</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="toolbar no-print">
    <button onclick="window.print()">Print / Save PDF</button>
    <button id="saveBtn">Save</button>
    <button id="clearBtn">Clear</button>
  </div>

  <div class="sheet">
    <header class="header">
      <div class="brand">
        <div class="title">PROJECT TIME RECORD</div>
        <div class="subtitle">Super Company</div>
      </div>
      <div class="meta-grid">
        <label><span class="label">Employee</span><input id="employee" class="line"/></label>
        <label><span class="label">Approver</span><input id="approver" class="line"/></label>
        <label><span class="label">Place</span><input id="place" class="line"/></label>
        <label><span class="label">Employee Phone</span><input id="phone" class="line"/></label>
        <label><span class="label">Employee Email</span><input id="email" class="line"/></label>
        <label><span class="label">Week Ending (Date)</span><input id="weekEnding" type="date" class="line"/></label>
      </div>
    </header>

    <table class="grid" id="timesheet">
      <thead>
        <tr>
          <th>DAY</th>
          <th>DATE</th>
          <th>TIME IN</th>
          <th>LUNCH (mins)</th>
          <th>TIME OUT</th>
          <th>TOTAL (hrs)</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="5" class="right">TOTAL HOURS</td>
          <td id="totalHours"></td>
        </tr>
        <tr>
          <td colspan="5" class="right">RATE PER HOUR</td>
          <td><input id="rate" type="number" step="0.01" class="cell-input" placeholder="$0.00"></td>
        </tr>
        <tr>
          <td colspan="5" class="right">TOTAL PAY</td>
          <td id="totalPay"></td>
        </tr>
      </tfoot>
    </table>

    <div class="signatures">
      <div><div class="line"></div><div class="label">EMPLOYEE SIGNATURE</div></div>
      <div><div class="line"></div><div class="label">APPROVER SIGNATURE</div></div>
      <div><div class="line small"></div><div class="label">DATE</div></div>
      <div><div class="line small"></div><div class="label">DATE</div></div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "fillable_timesheet_v1";

    const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
    const tbody = document.querySelector("#timesheet tbody");

    function timeToMinutes(t){
      if(!t) return null;
      const [h,m] = t.split(":").map(Number);
      return h*60 + m;
    }
    function minutesToHours(min){
      if(min==null) return "";
      return (min/60).toFixed(2);
    }
    function calcRowTotal(row){
      const tin = row.querySelector(".time-in").value;
      const tout = row.querySelector(".time-out").value;
      const lunch = parseInt(row.querySelector(".lunch").value || "0", 10);
      const a = timeToMinutes(tin), b = timeToMinutes(tout);
      if(a==null || b==null || b<a) { return ""; }
      const mins = Math.max(0, (b - a) - (isNaN(lunch)?0:lunch));
      return minutesToHours(mins);
    }
    function recalc(){
      let total = 0;
      tbody.querySelectorAll("tr").forEach(tr => {
        const cell = tr.querySelector(".total");
        const val = parseFloat(calcRowTotal(tr));
        cell.textContent = isNaN(val) ? "" : val.toFixed(2);
        if(!isNaN(val)) total += val;
      });
      document.querySelector("#totalHours").textContent = total.toFixed(2);
      const rate = parseFloat(document.querySelector("#rate").value || "0");
      document.querySelector("#totalPay").textContent = rate>0 ? "$" + (rate*total).toFixed(2) : "";
    }

    function buildRows(){
      days.forEach(d => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${d}</td>
          <td><input type="date" class="cell-input date"></td>
          <td><input type="time" class="cell-input time-in"></td>
          <td><input type="number" min="0" step="5" value="30" class="cell-input lunch"></td>
          <td><input type="time" class="cell-input time-out"></td>
          <td class="total"></td>
        `;
        tbody.appendChild(tr);
      });
      tbody.addEventListener("input", recalc);
      document.querySelector("#rate").addEventListener("input", recalc);
    }

    function save(){
      const data = {
        header: {
          employee: document.querySelector("#employee").value,
          approver: document.querySelector("#approver").value,
          place: document.querySelector("#place").value,
          phone: document.querySelector("#phone").value,
          email: document.querySelector("#email").value,
          weekEnding: document.querySelector("#weekEnding").value,
          rate: document.querySelector("#rate").value
        },
        rows: Array.from(tbody.querySelectorAll("tr")).map(tr => ({
          date: tr.querySelector(".date").value,
          tin: tr.querySelector(".time-in").value,
          lunch: tr.querySelector(".lunch").value,
          tout: tr.querySelector(".time-out").value
        }))
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      alert("Saved on this device.");
    }
    function load(){
      const s = localStorage.getItem(STORAGE_KEY);
      if(!s) return;
      try{
        const data = JSON.parse(s);
        document.querySelector("#employee").value = data.header.employee || "";
        document.querySelector("#approver").value = data.header.approver || "";
        document.querySelector("#place").value = data.header.place || "";
        document.querySelector("#phone").value = data.header.phone || "";
        document.querySelector("#email").value = data.header.email || "";
        document.querySelector("#weekEnding").value = data.header.weekEnding || "";
        document.querySelector("#rate").value = data.header.rate || "";
        data.rows.forEach((r, i) => {
          const tr = tbody.querySelectorAll("tr")[i];
          if(!tr) return;
          tr.querySelector(".date").value = r.date || "";
          tr.querySelector(".time-in").value = r.tin || "";
          tr.querySelector(".lunch").value = r.lunch || "30";
          tr.querySelector(".time-out").value = r.tout || "";
        });
      }catch(e){}
    }
    function clearAll(){
      if(!confirm("Clear all fields?")) return;
      localStorage.removeItem(STORAGE_KEY);
      document.querySelectorAll("input").forEach(i => { if(i.type!=="button") i.value = ""; });
      tbody.querySelectorAll(".lunch").forEach(i => i.value="30");
      recalc();
    }

    buildRows();
    load();
    recalc();

    document.querySelector("#saveBtn").addEventListener("click", save);
    document.querySelector("#clearBtn").addEventListener("click", clearAll);

    // Improve print: show date of export
    window.addEventListener("beforeprint", ()=>{
      // force a final recalc
      recalc();
    });
  </script>
</body>
</html>