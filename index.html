<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Project Time Record — Fillable</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="toolbar no-print">
    <button onclick="window.print()">Print / Save PDF</button>
    <button id="saveBtn">Save</button>
    <button id="clearBtn">Clear</button>
  </div>

  <div class="sheet">
    <header class="header">
      <div class="brand">
        <div class="title">PROJECT TIME RECORD</div>
        <div class="subtitle">Super Company</div>
      </div>
      <div class="meta-grid">
        <label><span class="label">Employee</span><input id="employee" class="line"/></label>
        <label><span class="label">Approver</span><input id="approver" class="line"/></label>
        <label><span class="label">Place</span><input id="place" class="line"/></label>
        <label><span class="label">Employee Phone</span><input id="phone" class="line"/></label>
        <label><span class="label">Employee Email</span><input id="email" class="line"/></label>
        <label><span class="label">Week Ending (Date)</span><input id="weekEnding" type="date" class="line"/></label>
      </div>
    </header>

    <div class="table-wrap">
      <table class="grid" id="timesheet">
        <thead>
          <tr>
            <th>DAY</th>
            <th>DATE</th>
            <th>TIME IN</th>
            <th>LUNCH (mins)</th>
            <th>TIME OUT</th>
            <th>PER DIEM ($)</th>
            <th>TOTAL (hrs)</th>
            <th>EMPLOYEE SIGN</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="6" class="right">TOTAL HOURS</td>
            <td id="totalHours"></td>
            <td></td>
          </tr>
          <tr>
            <td colspan="6" class="right">RATE PER HOUR</td>
            <td><input id="rate" type="number" step="0.01" class="cell-input number" placeholder="$0.00"></td>
            <td></td>
          </tr>
          <tr>
            <td colspan="6" class="right">TOTAL PAY (Rate×Hours + Per-Diem Sum)</td>
            <td id="totalPay"></td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="signatures compact editable">
      <div class="sig-row">
        <span class="sig-label">Employee</span>
        <input id="sigEmployee" class="sig-input" placeholder="Name" />
        <span class="sig-label">Date</span>
        <input id="sigEmpDate" type="date" class="sig-input short" />
      </div>
      <div class="sig-row">
        <span class="sig-label">Approval</span>
        <input id="sigApproval" class="sig-input" placeholder="Name" />
        <span class="sig-label">Date</span>
        <input id="sigApprDate" type="date" class="sig-input short" />
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "fillable_timesheet_corrected_v1";
    const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
    const tbody = document.querySelector("#timesheet tbody");

    function timeToMinutes(t){
      if(!t) return null;
      const [h,m] = t.split(":").map(Number);
      return h*60 + m;
    }
    function minutesToHours(min){
      if(min==null) return "";
      return (min/60).toFixed(2);
    }
    function currency(n){
      if(isNaN(n)) return "";
      return "$" + n.toFixed(2);
    }

    function calcRowTotal(row){
      const tin = row.querySelector(".time-in").value;
      const tout = row.querySelector(".time-out").value;
      const lunch = parseInt(row.querySelector(".lunch").value || "0", 10);
      const a = timeToMinutes(tin), b = timeToMinutes(tout);
      if(a==null || b==null || b<a) { return ""; }
      const mins = Math.max(0, (b - a) - (isNaN(lunch)?0:lunch));
      return minutesToHours(mins);
    }

    function recalc(){
      let totalHours = 0;
      let perDiemSum = 0;
      tbody.querySelectorAll("tr").forEach(tr => {
        // hours
        const cell = tr.querySelector(".total");
        const val = parseFloat(calcRowTotal(tr));
        cell.textContent = isNaN(val) ? "" : val.toFixed(2);
        if(!isNaN(val)) totalHours += val;
        // per diem sum (day-by-day; editable)
        const pd = parseFloat(tr.querySelector(".perdiem").value || "0");
        if(!isNaN(pd)) perDiemSum += pd;
      });
      document.querySelector("#totalHours").textContent = totalHours.toFixed(2);

      const rate = parseFloat(document.querySelector("#rate").value || "0");
      const totalPay = (rate>0 ? rate * totalHours : 0) + perDiemSum;
      document.querySelector("#totalPay").textContent = totalPay>0 ? currency(totalPay) : "";
    }

    function buildRows(){
      days.forEach(d => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="day">${d}</td>
          <td><input type="date" class="cell-input date"></td>
          <td><input type="time" class="cell-input time-in"></td>
          <td><input type="number" min="0" step="5" value="30" class="cell-input lunch"></td>
          <td><input type="time" class="cell-input time-out"></td>
          <td><input type="number" class="cell-input number perdiem" step="0.01" value="50"></td>
          <td class="total"></td>
          <td><input class="cell-input sign" placeholder="Sign/Initials"></td>
        `;
        tbody.appendChild(tr);
      });
      tbody.addEventListener("input", recalc);
      document.querySelector("#rate").addEventListener("input", recalc);
    }

    function save(){
      const data = {
        header: {
          employee: document.querySelector("#employee").value,
          approver: document.querySelector("#approver").value,
          place: document.querySelector("#place").value,
          phone: document.querySelector("#phone").value,
          email: document.querySelector("#email").value,
          weekEnding: document.querySelector("#weekEnding").value,
          rate: document.querySelector("#rate").value,
          sigEmployee: document.querySelector("#sigEmployee").value,
          sigEmpDate: document.querySelector("#sigEmpDate").value,
          sigApproval: document.querySelector("#sigApproval").value,
          sigApprDate: document.querySelector("#sigApprDate").value
        },
        rows: Array.from(tbody.querySelectorAll("tr")).map(tr => ({
          date: tr.querySelector(".date").value,
          tin: tr.querySelector(".time-in").value,
          lunch: tr.querySelector(".lunch").value,
          tout: tr.querySelector(".time-out").value,
          perdiem: tr.querySelector(".perdiem").value,
          sign: tr.querySelector(".sign").value
        }))
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      alert("Saved on this device.");
    }
    function load(){
      const s = localStorage.getItem(STORAGE_KEY);
      if(!s) return;
      try{
        const data = JSON.parse(s);
        document.querySelector("#employee").value = data.header.employee || "";
        document.querySelector("#approver").value = data.header.approver || "";
        document.querySelector("#place").value = data.header.place || "";
        document.querySelector("#phone").value = data.header.phone || "";
        document.querySelector("#email").value = data.header.email || "";
        document.querySelector("#weekEnding").value = data.header.weekEnding || "";
        document.querySelector("#rate").value = data.header.rate || "";
        document.querySelector("#sigEmployee").value = data.header.sigEmployee || "";
        document.querySelector("#sigEmpDate").value = data.header.sigEmpDate || "";
        document.querySelector("#sigApproval").value = data.header.sigApproval || "";
        document.querySelector("#sigApprDate").value = data.header.sigApprDate || "";
        data.rows.forEach((r, i) => {
          const tr = tbody.querySelectorAll("tr")[i];
          if(!tr) return;
          tr.querySelector(".date").value = r.date || "";
          tr.querySelector(".time-in").value = r.tin || "";
          tr.querySelector(".lunch").value = r.lunch || "30";
          tr.querySelector(".time-out").value = r.tout || "";
          tr.querySelector(".perdiem").value = r.perdiem || "50";
          tr.querySelector(".sign").value = r.sign || "";
        });
      }catch(e){}
    }
    function clearAll(){
      if(!confirm("Clear all fields?")) return;
      localStorage.removeItem(STORAGE_KEY);
      document.querySelectorAll("input").forEach(i => { if(i.type!=="button") i.value = ""; });
      tbody.querySelectorAll(".lunch").forEach(i => i.value="30");
      tbody.querySelectorAll(".perdiem").forEach(i => i.value="50");
      recalc();
    }

    buildRows();
    load();
    recalc();

    document.querySelector("#saveBtn").addEventListener("click", save);
    document.querySelector("#clearBtn").addEventListener("click", clearAll);
    window.addEventListener("beforeprint", recalc);
  </script>
</body>
</html>